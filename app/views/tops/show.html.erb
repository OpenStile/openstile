<% provide(:title, @top.name) %>

<%= render "shared/header" %>

<div class="recommendation-details block">
  <div class="container">
    <div class="row">
      <div class="col-md-offset-1 col-md-5 col-xs-offset-1 col-xs-5">
        <% if @top.image.nil? %>
          <img class="img-responsive" src="http://placehold.it/400x500">
        <% else %>
          <%= cl_image_tag(@top.image.name, :width=>400, :height=>500, :crop=>:fill, :gravity=>:face, :class => "img-responsive") %>
        <% end %>
      </div>
      </div>
      <div class="col-md-5 col-xs-5 text-center">
        <hr>
        <h1><%= @top.name %></h1><br />
        <h2><%= "$%6.2f" % @top.price.to_f %></h2><br />
        <h2><%= link_to @top.retailer.name, retailer_path(@top.retailer) %></h2><br />
        <h4><%= @top.description %></h4>
        <hr>
        <p><%= link_to("View in online store", @top.web_link, target: '_blank') unless @top.web_link.blank? %></p>
      </div>
    </div>

    <% if shopper_signed_in? %>
      <% existing_drop_in = DropIn.upcoming_for_shopper_at_retailer(current_shopper.id, @top.retailer.id).first %>
      <% if existing_drop_in.nil? %>
        <%= render 'shared/schedule_drop_in', retailer: @top.retailer, 
                                              for_retailer: false,
                                              item: @top %>
      <% else %>
        <%= render 'shared/update_existing_drop_in', retailer: @top.retailer,
                                                     drop_in: existing_drop_in,
                                                     item: @top %>
      <% end %>
    <% end %>
  </div>
</div>

